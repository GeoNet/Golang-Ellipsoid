// These are the 'at' tests from the Geo::Ellipsoid package. 
package main

import "fmt"
import "math"
import "./ellipsoid"

var pass_counter, fail int

func delta_within(v float64, t float64, d float64) {
	diff := math.Fabs(v - t)
	if diff < d {
		fmt.Printf("Test OK\n")
		pass_counter++
	} else {
		fmt.Printf("Test FAIL\n")
		fail++
		fmt.Printf("v - t = %f - %f = %f\n", v, t, diff)
	}
}
func delta_ok(value float64, target float64) {
	delta_within(value, target, 1e-1)
}

type testobject struct {
	lat1 float64
	lon1 float64
	d float64 // distance
	b float64 // bearing
	lat2 float64
	lon2 float64
}

func main() {

	e1 := ellipsoid.Init("WGS84", ellipsoid.Degrees, ellipsoid.Meter, ellipsoid.Longitude_not_symmetric, ellipsoid.Bearing_not_symmetric)

        all_tests_e1 := []testobject{
		{-38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, 190.880662670944},
		{-1.549886, 336.466532, 3150.908018, 129.475800, -1.56800166865689, 336.48838856866},
		{-11.235004, 282.756437, 1175.174596, 192.154112, -11.2453901777647, 282.754171348951},
		{-11.919645, 340.641713, 891.615326, 153.274434, -11.9268441615802, 340.645393779515},
		{-12.674750, 312.909013, 3145.681733, 358.190380, -12.6463295522285, 312.908098770026},
		{-14.608137, 30.094655, 6390.954467, 5.838786, -14.5506757312212, 30.1006878108632},
		{-15.074589, 56.914619, 7164.429748, 173.487403, -15.1389196660838, 56.9221791309893},
		{-17.562152, 276.168590, 5665.575297, 135.075003, -17.5983930208429, 276.206284342329},
		{-18.084386, 221.381908, 5982.507117, 338.372199, -18.0341383666819, 221.361083689563},
		{-19.222949, 91.053479, 1338.282294, 224.550018, -19.2315645979899, 91.0445501139712},
		{-19.715571, 5.847281, 5797.359451, 217.945830, -19.7568659277085, 5.81326755286751},
		{-20.359063, 296.599967, 1628.799157, 220.382033, -20.3702696544288, 296.589859316515},
		{-20.725615, 342.386744, 817.492741, 221.236681, -20.7311674916701, 342.381570767838},
		{-23.824528, 241.336801, 2179.408647, 175.675228, -23.8441499994285, 241.338413904748},
		{-25.789728, 191.087862, 5544.330184, 5.661707, -25.7399260442896, 191.093313592838},
		{-26.934636, 30.474042, 991.354098, 72.872537, -26.9320006429192, 30.4835810246334},
		{-27.100512, 351.279156, 7472.750836, 215.020221, -27.1557353506078, 351.235890988004},
		{-27.107665, 34.103508, 4111.521802, 243.342905, -27.1243073483822, 34.0664465612592},
		{-30.360974, 322.538048, 1475.216259, 59.263577, -30.3541720736129, 322.551236568074},
		{-30.523088, 295.285416, 434.243851, 69.446059, -30.5217130438923, 295.289652469157},
		{-30.550903, 251.787663, 3538.553197, 192.651457, -30.5820467190056, 251.77958340328},
		{-33.041308, 313.249683, 9757.188845, 231.280178, -33.0963123185806, 313.168134096477},
		{-35.454628, 153.274308, 1072.202082, 83.828810, -35.4535887262639, 153.286050580698},
		{-38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, 190.880662670944},
		{-4.121498, 262.769582, 9308.966888, 178.488881, -4.205651784836, 262.771793465594},
		{-4.285155, 344.319438, 2988.101263, 161.216474, -4.31073788511537, 344.328105973954},
		{-41.090138, 219.595320, 2968.409513, 329.275936, -41.0671591825447, 219.577276687536},
		{-41.167125, 221.956378, 7772.438867, 65.964741, -41.1385887169891, 222.040925759323},
		{-41.623677, 208.834416, 1610.051073, 95.264953, -41.6250052190667, 208.853654884741},
		{-45.137898, 141.541847, 1959.185717, 345.810769, -45.1208065938125, 141.535743596221},
		{-48.109675, 147.804097, 3851.598342, 313.390029, -48.0858733128975, 147.766528156688},
		{-5.158991, 259.931626, 4773.871059, 200.977967, -5.19929911014967, 259.916209822012},
		{-58.652658, 205.140021, 1309.266436, 310.900238, -58.6449608105583, 205.122978574437},
		{-6.203945, 247.684632, 324.776721, 145.835257, -6.20637500756398, 247.686280489375},
		{-6.856999, 130.887597, 7763.221087, 214.956451, -6.91453101371976, 130.847349224089},
		{-60.365048, 156.813021, 10.808349, 186.644917, -60.3651441594277, 156.812997908757},
		{-61.797586, 265.384439, 9288.961574, 50.299469, -61.7442754682937, 265.519702300482},
		{-62.773742, 62.342057, 8353.955232, 297.642864, -62.738893257913, 62.197305731553},
		{-63.553064, 13.025588, 4062.612060, 159.653083, -63.587232627602, 13.0540374200214},
		{-63.776699, 134.057987, 8903.026576, 322.164617, -63.7135798907925, 133.947510160671},
		{-64.270514, 45.105873, 5363.627587, 140.110968, -64.3074130400444, 45.1769508481278},
		{-67.726400, 52.964864, 873.162562, 51.679717, -67.72154487153, 52.9810494838027},
		{-67.846380, 99.041109, 8317.496525, 12.266233, -67.7735027510774, 99.0829538757835},
		{-69.865357, 188.114494, 8437.219491, 56.767387, -69.8238139675753, 188.297759634022},
		{-69.938162, 165.492639, 7837.486006, 155.206150, -70.0019179240387, 165.578716457451},
		{-7.204161, 179.885067, 2512.365469, 183.789892, -7.22682901108564, 179.883563144484},
		{-70.362274, 322.490547, 2582.286613, 323.109595, -70.3437578191681, 322.449273778159},
		{-70.754141, 43.777574, 5605.534780, 236.246900, -70.7820124418521, 43.6507601360177},
		{-79.523730, 324.065787, 2171.798854, 67.387309, -79.5162359949416, 324.164444728713},
		{-9.089458, 237.666143, 2239.328571, 14.324009, -9.06984018685994, 237.671182904242},
		{0.611947, 100.746342, 9973.981611, 131.132873, 0.55261091016823, 100.813828549171},
		{1.348841, 276.378914, 9829.506468, 166.918436, 1.26225340172628, 276.398904775364},
		{1.554684, 167.837560, 3131.747930, 59.213013, 1.56918059097552, 167.861737784577},
		{11.191046, 106.356107, 4851.812086, 51.506296, 11.2183452049465, 106.390879919224},
		{12.921677, 151.249684, 4165.773730, 74.171323, 12.9319448741798, 151.286617723767},
		{13.742087, 63.763606, 4388.913613, 181.241894, 13.7024269689814, 63.7627262988153},
		{13.769616, 110.113762, 1308.712391, 343.083492, 13.78093309177, 110.110240703272},
		{18.396198, 143.265994, 7349.515732, 7.492742, 18.4620306038802, 143.275067859029},
		{19.041053, 175.994927, 5177.048787, 281.316611, 19.0502245946019, 175.946699498326},
		{19.497371, 220.383733, 5718.963068, 119.960301, 19.4715643857244, 220.430924356231},
		{21.323022, 38.682180, 2136.676569, 319.096878, 21.3376068588205, 38.6686929767104},
		{22.955732, 47.794852, 8246.705286, 185.066176, 22.8815557299625, 47.7877547716615},
		{23.630668, 183.960989, 4996.609275, 55.919867, 23.6559427295585, 184.001554318971},
		{25.726049, 310.324628, 6650.414158, 289.782664, 25.7463533347373, 310.262255281203},
		{27.335146, 320.699240, 8536.611848, 271.060094, 27.336544790133, 320.612989777828},
		{28.972667, 278.549276, 2327.886028, 78.654517, 28.9767972109023, 278.572694719835},
		{29.289568, 92.918510, 8113.351247, 35.674974, 29.3490208963828, 92.9672340946057},
		{3.076206, 112.117539, 9835.156864, 258.316434, 3.05819117659668, 112.03089587221},
		{33.139375, 123.465763, 9357.301964, 74.517011, 33.1618601109721, 123.562433957867},
		{34.623205, 31.357288, 7988.594185, 134.837127, 34.5724140545376, 31.4190231012302},
		{35.067827, 307.917302, 8369.643934, 170.157432, 34.993494196776, 307.932973187806},
		{35.694667, 300.725605, 3436.937434, 117.656799, 35.6802840942486, 300.75923369164},
		{40.356751, 153.160097, 5740.614634, 305.081769, 40.3864504304799, 153.104771159051},
		{41.911754, 138.151813, 2308.592027, 18.057173, 41.9315142758588, 138.160440601835},
		{42.839865, 327.847225, 4283.496948, 308.416746, 42.8638173053354, 327.806155932557},
		{44.782374, 163.862303, 9245.465886, 45.480517, 44.8406766505374, 163.945679242349},
		{45.339403, 315.409130, 2618.493509, 45.478452, 45.3559203918087, 315.432955775137},
		{46.204817, 295.396070, 8211.580529, 221.904425, 46.1498123310369, 295.325077737085},
		{46.867006, 44.857631, 9269.632604, 208.315002, 46.7935841133508, 44.8000433688766},
		{46.911457, 128.191393, 9713.277037, 65.802158, 46.9472109419573, 128.307769547944},
		{5.067958, 24.268528, 8172.788174, 38.204963, 5.12603197726362, 24.3141162471053},
		{51.523602, 137.628739, 7272.747263, 125.320332, 51.4857783969849, 137.714167388512},
		{54.780139, 8.410011, 9928.854395, 201.999534, 54.6974261720386, 8.3523242715081},
		{6.190847, 124.992089, 3854.030593, 133.198367, 6.16698993482276, 125.017473198902},
		{6.371687, 279.113190, 364.003776, 337.941402, 6.37473803790458, 279.111954845525},
		{6.782845, 255.237805, 3347.905328, 296.785788, 6.79648733577162, 255.21076894319},
		{64.324875, 209.104753, 8132.271740, 281.572223, 64.3394159635433, 208.939932681831},
		{64.918979, 305.870922, 2833.416804, 309.531171, 64.9351480714201, 305.824710582963},
		{66.084685, 30.192264, 1657.534288, 243.904448, 66.0781430272163, 30.1593794067059},
		{68.057252, 192.858027, 4711.422894, 252.341167, 68.0444035490457, 192.750473587802},
		{68.128342, 115.791221, 4772.498578, 204.791356, 68.0894895788839, 115.743184646015},
		{68.994921, 41.466113, 4652.207721, 141.053623, 68.9624691494271, 41.5390782800596},
		{7.193705, 159.638737, 3177.227490, 155.223944, 7.16761967835449, 159.650791084088},
		{71.112709, 8.834545, 4018.709300, 72.034521, 71.1237884898956, 8.9403714174623},
		{72.833548, 317.667505, 62.516492, 29.001224, 72.8340378772457, 317.668425118621},
		{74.606774, 294.646962, 7101.250686, 211.655252, 74.552581484185, 294.521662695934},
		{74.707726, 290.854396, 7214.189514, 304.432840, 74.7441816240245, 290.651891561222},
		{75.481994, 274.248595, 1614.672640, 65.431283, 75.4880029055828, 274.301072964265},
		{77.751666, 6.954744, 8617.247199, 43.480525, 77.8075587887118, 7.20615011733763},
		{77.940951, 38.523563, 1493.070064, 336.795873, 77.9532419255974, 38.4983240629321}}

	for _, v := range all_tests_e1 {
		lat3, lon3 := e1.At(v.lat1, v.lon1, v.d, v.b)
		delta_ok(lat3, v.lat2)
		delta_ok(lon3, v.lon2)
	}

	e2 := ellipsoid.Init("WGS84", ellipsoid.Degrees, ellipsoid.Meter, ellipsoid.Longitude_is_symmetric, ellipsoid.Bearing_not_symmetric)

        all_tests_e2 := []testobject{
		{-0.582762, 29.118576, 2946.165884, 106.326170, -0.590251306822743, 29.1439759994689},
		{-1.549886, 336.466532, 3150.908018, 129.475800, -1.56800166865689, -23.5116114313395},
		{-11.235004, 282.756437, 1175.174596, 192.154112, -11.2453901777647, -77.2458286510488},
		{-11.919645, 340.641713, 891.615326, 153.274434, -11.9268441615802, -19.354606220485},
		{-12.674750, 312.909013, 3145.681733, 358.190380, -12.6463295522285, -47.0919012299736},
		{-14.608137, 30.094655, 6390.954467, 5.838786, -14.5506757312212, 30.1006878108632},
		{-15.074589, 56.914619, 7164.429748, 173.487403, -15.1389196660838, 56.9221791309893},
		{-17.562152, 276.168590, 5665.575297, 135.075003, -17.5983930208429, -83.7937156576705},
		{-18.084386, 221.381908, 5982.507117, 338.372199, -18.0341383666819, -138.638916310437},
		{-19.222949, 91.053479, 1338.282294, 224.550018, -19.2315645979899, 91.0445501139712},
		{-19.715571, 5.847281, 5797.359451, 217.945830, -19.7568659277085, 5.81326755286751},
		{-20.359063, 296.599967, 1628.799157, 220.382033, -20.3702696544288, -63.4101406834851},
		{-20.725615, 342.386744, 817.492741, 221.236681, -20.7311674916701, -17.6184292321621},
		{-23.824528, 241.336801, 2179.408647, 175.675228, -23.8441499994285, -118.661586095252},
		{-25.789728, 191.087862, 5544.330184, 5.661707, -25.7399260442896, -168.906686407162},
		{-26.934636, 30.474042, 991.354098, 72.872537, -26.9320006429192, 30.4835810246334},
		{-27.100512, 351.279156, 7472.750836, 215.020221, -27.1557353506078, -8.76410901199599},
		{-27.107665, 34.103508, 4111.521802, 243.342905, -27.1243073483822, 34.0664465612592},
		{-30.360974, 322.538048, 1475.216259, 59.263577, -30.3541720736129, -37.4487634319259},
		{-30.523088, 295.285416, 434.243851, 69.446059, -30.5217130438923, -64.7103475308431},
		{-30.550903, 251.787663, 3538.553197, 192.651457, -30.5820467190056, -108.22041659672},
		{-33.041308, 313.249683, 9757.188845, 231.280178, -33.0963123185806, -46.8318659035227},
		{-35.454628, 153.274308, 1072.202082, 83.828810, -35.4535887262639, 153.286050580698},
		{-38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, -169.119337329056},
		{-4.121498, 262.769582, 9308.966888, 178.488881, -4.205651784836, -97.2282065344056},
		{-4.285155, 344.319438, 2988.101263, 161.216474, -4.31073788511537, -15.6718940260457},
		{-41.090138, 219.595320, 2968.409513, 329.275936, -41.0671591825447, -140.422723312464},
		{-41.167125, 221.956378, 7772.438867, 65.964741, -41.1385887169891, -137.959074240677},
		{-41.623677, 208.834416, 1610.051073, 95.264953, -41.6250052190667, -151.146345115259},
		{-45.137898, 141.541847, 1959.185717, 345.810769, -45.1208065938125, 141.535743596221},
		{-48.109675, 147.804097, 3851.598342, 313.390029, -48.0858733128975, 147.766528156688},
		{-5.158991, 259.931626, 4773.871059, 200.977967, -5.19929911014967, -100.083790177988},
		{-58.652658, 205.140021, 1309.266436, 310.900238, -58.6449608105583, -154.877021425563},
		{-6.203945, 247.684632, 324.776721, 145.835257, -6.20637500756398, -112.313719510625},
		{-6.856999, 130.887597, 7763.221087, 214.956451, -6.91453101371976, 130.847349224089},
		{-60.365048, 156.813021, 10.808349, 186.644917, -60.3651441594277, 156.812997908757},
		{-61.797586, 265.384439, 9288.961574, 50.299469, -61.7442754682937, -94.4802976995183},
		{-62.773742, 62.342057, 8353.955232, 297.642864, -62.738893257913, 62.197305731553},
		{-63.553064, 13.025588, 4062.612060, 159.653083, -63.587232627602, 13.0540374200214},
		{-63.776699, 134.057987, 8903.026576, 322.164617, -63.7135798907925, 133.947510160671},
		{-64.270514, 45.105873, 5363.627587, 140.110968, -64.3074130400444, 45.1769508481278},
		{-67.726400, 52.964864, 873.162562, 51.679717, -67.72154487153, 52.9810494838027},
		{-67.846380, 99.041109, 8317.496525, 12.266233, -67.7735027510774, 99.0829538757835},
		{-69.865357, 188.114494, 8437.219491, 56.767387, -69.8238139675753, -171.702240365978},
		{-69.938162, 165.492639, 7837.486006, 155.206150, -70.0019179240387, 165.578716457451},
		{-7.204161, 179.885067, 2512.365469, 183.789892, -7.22682901108564, 179.883563144484},
		{-70.362274, 322.490547, 2582.286613, 323.109595, -70.3437578191681, -37.5507262218411},
		{-70.754141, 43.777574, 5605.534780, 236.246900, -70.7820124418521, 43.6507601360177},
		{-79.523730, 324.065787, 2171.798854, 67.387309, -79.5162359949416, -35.8355552712871},
		{-9.089458, 237.666143, 2239.328571, 14.324009, -9.06984018685994, -122.328817095758},
		{0.611947, 100.746342, 9973.981611, 131.132873, 0.55261091016823, 100.813828549171},
		{1.348841, 276.378914, 9829.506468, 166.918436, 1.26225340172628, -83.6010952246363},
		{1.554684, 167.837560, 3131.747930, 59.213013, 1.56918059097552, 167.861737784577},
		{11.191046, 106.356107, 4851.812086, 51.506296, 11.2183452049465, 106.390879919224},
		{12.921677, 151.249684, 4165.773730, 74.171323, 12.9319448741798, 151.286617723767},
		{13.742087, 63.763606, 4388.913613, 181.241894, 13.7024269689814, 63.7627262988153},
		{13.769616, 110.113762, 1308.712391, 343.083492, 13.78093309177, 110.110240703272},
		{18.396198, 143.265994, 7349.515732, 7.492742, 18.4620306038802, 143.275067859029},
		{19.041053, 175.994927, 5177.048787, 281.316611, 19.0502245946019, 175.946699498326},
		{19.497371, 220.383733, 5718.963068, 119.960301, 19.4715643857244, -139.569075643769},
		{21.323022, 38.682180, 2136.676569, 319.096878, 21.3376068588205, 38.6686929767104},
		{22.955732, 47.794852, 8246.705286, 185.066176, 22.8815557299625, 47.7877547716615},
		{23.630668, 183.960989, 4996.609275, 55.919867, 23.6559427295585, -175.998445681029},
		{25.726049, 310.324628, 6650.414158, 289.782664, 25.7463533347373, -49.7377447187972},
		{27.335146, 320.699240, 8536.611848, 271.060094, 27.336544790133, -39.3870102221718},
		{28.972667, 278.549276, 2327.886028, 78.654517, 28.9767972109023, -81.4273052801652},
		{29.289568, 92.918510, 8113.351247, 35.674974, 29.3490208963828, 92.9672340946057},
		{3.076206, 112.117539, 9835.156864, 258.316434, 3.05819117659668, 112.03089587221},
		{33.139375, 123.465763, 9357.301964, 74.517011, 33.1618601109721, 123.562433957867},
		{34.623205, 31.357288, 7988.594185, 134.837127, 34.5724140545376, 31.4190231012302},
		{35.067827, 307.917302, 8369.643934, 170.157432, 34.993494196776, -52.0670268121944},
		{35.694667, 300.725605, 3436.937434, 117.656799, 35.6802840942486, -59.2407663083597},
		{40.356751, 153.160097, 5740.614634, 305.081769, 40.3864504304799, 153.104771159051},
		{41.911754, 138.151813, 2308.592027, 18.057173, 41.9315142758588, 138.160440601835},
		{42.839865, 327.847225, 4283.496948, 308.416746, 42.8638173053354, -32.1938440674425},
		{44.782374, 163.862303, 9245.465886, 45.480517, 44.8406766505374, 163.945679242349},
		{45.339403, 315.409130, 2618.493509, 45.478452, 45.3559203918087, -44.5670442248635},
		{46.204817, 295.396070, 8211.580529, 221.904425, 46.1498123310369, -64.6749222629154},
		{46.867006, 44.857631, 9269.632604, 208.315002, 46.7935841133508, 44.8000433688766},
		{46.911457, 128.191393, 9713.277037, 65.802158, 46.9472109419573, 128.307769547944},
		{5.067958, 24.268528, 8172.788174, 38.204963, 5.12603197726362, 24.3141162471053},
		{51.523602, 137.628739, 7272.747263, 125.320332, 51.4857783969849, 137.714167388512},
		{54.780139, 8.410011, 9928.854395, 201.999534, 54.6974261720386, 8.3523242715081},
		{6.190847, 124.992089, 3854.030593, 133.198367, 6.16698993482276, 125.017473198902},
		{6.371687, 279.113190, 364.003776, 337.941402, 6.37473803790458, -80.8880451544753},
		{6.782845, 255.237805, 3347.905328, 296.785788, 6.79648733577162, -104.78923105681},
		{64.324875, 209.104753, 8132.271740, 281.572223, 64.3394159635433, -151.060067318169},
		{64.918979, 305.870922, 2833.416804, 309.531171, 64.9351480714201, -54.1752894170374},
		{66.084685, 30.192264, 1657.534288, 243.904448, 66.0781430272163, 30.1593794067059},
		{68.057252, 192.858027, 4711.422894, 252.341167, 68.0444035490457, -167.249526412198},
		{68.128342, 115.791221, 4772.498578, 204.791356, 68.0894895788839, 115.743184646015},
		{68.994921, 41.466113, 4652.207721, 141.053623, 68.9624691494271, 41.5390782800596},
		{7.193705, 159.638737, 3177.227490, 155.223944, 7.16761967835449, 159.650791084088},
		{71.112709, 8.834545, 4018.709300, 72.034521, 71.1237884898956, 8.9403714174623},
		{72.833548, 317.667505, 62.516492, 29.001224, 72.8340378772457, -42.3315748813785},
		{74.606774, 294.646962, 7101.250686, 211.655252, 74.552581484185, -65.4783373040659},
		{74.707726, 290.854396, 7214.189514, 304.432840, 74.7441816240245, -69.3481084387778},
		{75.481994, 274.248595, 1614.672640, 65.431283, 75.4880029055828, -85.6989270357354},
		{77.751666, 6.954744, 8617.247199, 43.480525, 77.8075587887118, 7.20615011733763},
		{77.940951, 38.523563, 1493.070064, 336.795873, 77.9532419255974, 38.4983240629321}}

	for _, v := range all_tests_e2 {
		lat3, lon3 := e2.At(v.lat1, v.lon1, v.d, v.b)
		delta_ok(lat3, v.lat2)
		delta_ok(lon3, v.lon2)
	}

	fmt.Printf("Summary: pass_counter=%v fail=%v\n", pass_counter, fail)
}
